<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Calendrier d'amour üíñ</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background-image: url('amour.jpg');
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
    color: white;
    margin: 0;
    min-height: 100vh;
    padding: 2rem;
  }
  nav a {
    color: white;
    margin-right: 1rem;
    text-decoration: underline;
    cursor: pointer;
  }
  h1, h2 {
    text-align: center;
  }
  #calendar {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    gap: 5px;
    max-width: 700px;
    margin: 1rem auto;
    background: rgba(0,0,0,0.3);
    padding: 10px;
    border-radius: 10px;
  }
  .day {
    background: rgba(255,255,255,0.1);
    border-radius: 8px;
    padding: 10px;
    min-height: 80px;
    position: relative;
  }
  .day-number {
    font-weight: bold;
  }
  .event {
    background: #ff6f91;
    color: white;
    font-size: 0.85rem;
    margin-top: 5px;
    padding: 2px 4px;
    border-radius: 5px;
    cursor: default;
  }
  form {
    max-width: 400px;
    margin: 1rem auto;
    background: rgba(0,0,0,0.3);
    padding: 1rem;
    border-radius: 10px;
  }
  label, input, button {
    display: block;
    width: 100%;
    margin-bottom: 10px;
    font-size: 1rem;
  }
  button {
    background: #ff6f91;
    color: white;
    border: none;
    border-radius: 8px;
    cursor: pointer;
  }
  button:hover {
    background: #ff3c78;
  }
</style>
</head>
<body>

<nav>
  <a href="index.html">Accueil</a>
  <a href="calendrier.html">Calendrier</a>
</nav>

<h1>Calendrier d'amour üíñ</h1>

<form id="form-evenement">
  <label>
    Date de l'√©v√©nement :
    <input type="date" id="dateInput" required />
  </label>
  <label>
    Titre de l'√©v√©nement :
    <input type="text" id="titleInput" placeholder="Ex: Anniversaire" required />
  </label>
  <button type="submit">Ajouter l'√©v√©nement</button>
</form>

<div id="calendar"></div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js";
  import { getFirestore, collection, addDoc, getDocs, query, where, orderBy } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyAMn2TZKfGKkqTLi-PttISA1v2gg-rIeJo",
    authDomain: "webremindiou.firebaseapp.com",
    projectId: "webremindiou",
    storageBucket: "webremindiou.firebasestorage.app",
    messagingSenderId: "1041124249181",
    appId: "1:104112424918fbc101314d86347b4",
    measurementId: "G-XCS133MJ63"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  const calendarEl = document.getElementById('calendar');
  const form = document.getElementById('form-evenement');
  const dateInput = document.getElementById('dateInput');
  const titleInput = document.getElementById('titleInput');

  let currentYear, currentMonth;

  // Fonction pour cr√©er le calendrier et afficher les events
  async function createCalendar(year, month) {
    calendarEl.innerHTML = '';

    // Titre des jours
    const daysOfWeek = ['Lun', 'Mar', 'Mer', 'Jeu', 'Ven', 'Sam', 'Dim'];
    for(let dayName of daysOfWeek) {
      const dayHeader = document.createElement('div');
      dayHeader.textContent = dayName;
      dayHeader.style.fontWeight = 'bold';
      dayHeader.style.textAlign = 'center';
      calendarEl.appendChild(dayHeader);
    }

    // Date du premier jour du mois (lundi = 1, dimanche = 7)
    const firstDay = new Date(year, month, 1);
    let startDay = firstDay.getDay();
    if(startDay === 0) startDay = 7; // dimanche = 7

    // Nombre de jours dans le mois
    const daysInMonth = new Date(year, month+1, 0).getDate();

    // Ajouter cases vides avant le 1er jour (si le mois ne commence pas lundi)
    for(let i=1; i<startDay; i++) {
      const emptyCell = document.createElement('div');
      calendarEl.appendChild(emptyCell);
    }

    // R√©cup√©rer tous les √©v√©nements du mois depuis Firestore
    const firstDateStr = `${year}-${String(month+1).padStart(2,'0')}-01`;
    const lastDateStr = `${year}-${String(month+1).padStart(2,'0')}-${daysInMonth}`;

    // Firestore ne supporte pas directement des "between" sur dates string,
    // on stockera la date au format "YYYY-MM-DD" pour faciliter la comparaison.

    const eventsQuery = query(
      collection(db, "evenements"),
      where("date", ">=", firstDateStr),
      where("date", "<=", lastDateStr),
      orderBy("date")
    );

    const eventsSnapshot = await getDocs(eventsQuery);
    const events = {};
    eventsSnapshot.forEach(doc => {
      const ev = doc.data();
      if(!events[ev.date]) events[ev.date] = [];
      events[ev.date].push(ev.title);
    });

    // Cr√©er les cases pour chaque jour du mois
    for(let day=1; day<=daysInMonth; day++) {
      const dayCell = document.createElement('div');
      dayCell.classList.add('day');

      const dayNum = document.createElement('div');
      dayNum.classList.add('day-number');
      dayNum.textContent = day;
      dayCell.appendChild(dayNum);

      // Afficher les √©v√©nements du jour
      const dayStr = `${year}-${String(month+1).padStart(2,'0')}-${String(day).padStart(2,'0')}`;
      if(events[dayStr]) {
        for(const title of events[dayStr]) {
          const eventEl = document.createElement('div');
          eventEl.classList.add('event');
          eventEl.textContent = title;
          dayCell.appendChild(eventEl);
        }
      }

      calendarEl.appendChild(dayCell);
    }
  }

  // Ajout d'un √©v√©nement √† Firestore
  form.addEventListener('submit', async (e) => {
    e.preventDefault();

    const dateVal = dateInput.value;  // ex: "2024-08-14"
    const titleVal = titleInput.value.trim();

    if(!dateVal || !titleVal) {
      alert("Merci de remplir tous les champs.");
      return;
    }

    try {
      await addDoc(collection(db, "evenements"), {
        date: dateVal,
        title: titleVal
      });
      alert("√âv√©nement ajout√© !");
      form.reset();

      // Recr√©er calendrier avec les nouveaux √©v√©nements
      createCalendar(currentYear, currentMonth);
    } catch (err) {
      alert("Erreur lors de l'ajout : " + err.message);
    }
  });

  // Initialisation : afficher calendrier du mois courant
  const today = new Date();
  currentYear = today.getFullYear();
  currentMonth = today.getMonth();

  createCalendar(currentYear, currentMonth);

</script>

</body>
</html>
